<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Support Buddy">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#667eea">
    
    <!-- iPad/iPhone Icons -->
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%23667eea' width='100' height='100'/><text y='70' x='50' text-anchor='middle' font-size='60' fill='white'>ü§ù</text></svg>">
    
    <title>Student Support Buddy - Your Safe Space</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            touch-action: pan-y;
        }

        .container {
            background: white;
            border-radius: 0;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 100%;
            width: 100%;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* Desktop/Tablet layout */
        @media (min-width: 768px) {
            body {
                padding: 20px;
            }
            .container {
                border-radius: 20px;
                max-width: 800px;
                height: 90vh;
            }
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            flex-shrink: 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .header p {
            font-size: 13px;
            opacity: 0.9;
        }

        .install-banner {
            background: #fff3cd;
            color: #856404;
            padding: 12px;
            text-align: center;
            font-size: 13px;
            border-bottom: 1px solid #ffeaa7;
            display: none;
        }

        .install-banner button {
            background: #856404;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 15px;
            margin-left: 10px;
            cursor: pointer;
            font-weight: 600;
        }

        .chat-area {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f5f5f5;
            -webkit-overflow-scrolling: touch;
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.bot {
            justify-content: flex-start;
        }

        .message.user {
            justify-content: flex-end;
        }

        .message-bubble {
            max-width: 75%;
            padding: 12px 18px;
            border-radius: 18px;
            word-wrap: break-word;
            font-size: 15px;
            line-height: 1.5;
        }

        .message.bot .message-bubble {
            background: #e3f2fd;
            color: #1976d2;
            border-bottom-left-radius: 4px;
        }

        .message.user .message-bubble {
            background: #c8e6c9;
            color: #388e3c;
            border-bottom-right-radius: 4px;
        }

        .sample-questions {
            padding: 12px 15px;
            background: #f9f9f9;
            border-top: 1px solid #e0e0e0;
            flex-shrink: 0;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .sample-questions h3 {
            font-size: 13px;
            color: #666;
            margin-bottom: 10px;
            text-align: center;
        }

        .questions-grid {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding-bottom: 5px;
            -webkit-overflow-scrolling: touch;
        }

        .sample-question {
            padding: 10px 15px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            cursor: pointer;
            font-size: 13px;
            text-align: center;
            transition: all 0.3s;
            color: #555;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .sample-question:active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
            transform: scale(0.95);
        }

        .input-area {
            padding: 15px;
            background: white;
            border-top: 1px solid #e0e0e0;
            flex-shrink: 0;
        }

        .input-group {
            display: flex;
            gap: 10px;
        }

        #userInput {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.3s;
        }

        #userInput:focus {
            border-color: #667eea;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.3s;
            -webkit-appearance: none;
        }

        .btn-send {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-send:active {
            transform: scale(0.95);
        }

        .voice-controls {
            padding: 12px 15px;
            background: white;
            display: flex;
            justify-content: center;
            gap: 8px;
            border-top: 1px solid #e0e0e0;
            flex-shrink: 0;
        }

        .btn-voice {
            padding: 10px 18px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
            -webkit-appearance: none;
        }

        .btn-voice:active {
            background: #667eea;
            color: white;
            transform: scale(0.95);
        }

        .btn-voice.active {
            background: #667eea;
            color: white;
        }

        .storage-info {
            padding: 10px 15px;
            background: #e8f5e9;
            border-top: 1px solid #c8e6c9;
            text-align: center;
            font-size: 12px;
            color: #2e7d32;
            flex-shrink: 0;
        }

        .storage-buttons {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 8px;
            flex-wrap: wrap;
        }

        .btn-storage {
            padding: 6px 12px;
            border: 1px solid #4caf50;
            background: white;
            color: #4caf50;
            border-radius: 12px;
            cursor: pointer;
            font-size: 11px;
            font-weight: 600;
            transition: all 0.3s;
            -webkit-appearance: none;
        }

        .btn-storage:active {
            background: #4caf50;
            color: white;
            transform: scale(0.95);
        }

        .footer {
            padding: 12px 15px;
            background: #f5f5f5;
            border-top: 1px solid #e0e0e0;
            text-align: center;
            flex-shrink: 0;
        }

        .privacy-notice {
            font-size: 11px;
            color: #666;
            margin-bottom: 8px;
        }

        .emergency-info {
            font-size: 12px;
            color: #d32f2f;
            font-weight: 600;
        }

        .emergency-link {
            color: #d32f2f;
            text-decoration: none;
            border-bottom: 1px solid #d32f2f;
        }

        .typing-indicator {
            display: none;
            padding: 12px 18px;
            background: #e3f2fd;
            border-radius: 18px;
            border-bottom-left-radius: 4px;
            width: fit-content;
        }

        .typing-indicator span {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #1976d2;
            margin: 0 2px;
            animation: typing 1.4s infinite;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-10px);
            }
        }

        .chat-area::-webkit-scrollbar {
            width: 6px;
        }

        .chat-area::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .chat-area::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 3px;
        }

        /* Modal for viewing saved chats */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            max-width: 600px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            padding: 20px;
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }

        .modal-close {
            background: #f44336;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
        }

        .saved-conversation {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .saved-conversation h4 {
            color: #667eea;
            margin-bottom: 8px;
        }

        .saved-conversation .timestamp {
            font-size: 11px;
            color: #999;
            margin-bottom: 10px;
        }

        .saved-conversation .user-msg {
            background: #c8e6c9;
            padding: 8px 12px;
            border-radius: 12px;
            margin-bottom: 8px;
            color: #388e3c;
        }

        .saved-conversation .bot-msg {
            background: #e3f2fd;
            padding: 8px 12px;
            border-radius: 12px;
            color: #1976d2;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="install-banner" id="installBanner">
            üì± Install this app on your iPad for the best experience!
            <button onclick="promptInstall()">Install</button>
            <button onclick="closeInstallBanner()" style="background: transparent; color: #856404; border: 1px solid #856404;">Later</button>
        </div>

        <div class="header">
            <h1>ü§ù Student Support Buddy</h1>
            <p>Your Safe Space to Talk - We're Here to Listen</p>
        </div>

        <div class="chat-area" id="chatArea">
            <div class="message bot">
                <div class="message-bubble">
                    Hi there! üëã I'm your Student Support Buddy. This is a safe space where you can talk about anything that's bothering you - bullying, peer pressure, family issues, or just feeling overwhelmed. I'm here to listen and help. What would you like to talk about today?
                </div>
            </div>
            <div class="typing-indicator" id="typingIndicator">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>

        <div class="sample-questions">
            <h3>üí≠ Not sure what to say? Try these:</h3>
            <div class="questions-grid">
                <div class="sample-question" onclick="askQuestion('I am being bullied at school and don\'t know what to do')">
                    üòî I'm being bullied
                </div>
                <div class="sample-question" onclick="askQuestion('My friends are pressuring me to do something I don\'t want to do')">
                    üò∞ Feeling peer pressure
                </div>
                <div class="sample-question" onclick="askQuestion('I feel lonely and have no friends to talk to')">
                    üò¢ Feeling lonely
                </div>
                <div class="sample-question" onclick="askQuestion('I am stressed about my studies and exams')">
                    üìö Stressed about studies
                </div>
                <div class="sample-question" onclick="askQuestion('My parents are fighting a lot and it makes me sad')">
                    üè† Family problems
                </div>
                <div class="sample-question" onclick="askQuestion('Someone is spreading rumors about me')">
                    üò† Dealing with rumors
                </div>
            </div>
        </div>

        <div class="input-area">
            <div class="input-group">
                <input type="text" id="userInput" placeholder="Type your message here..." onkeypress="handleKeyPress(event)">
                <button class="btn btn-send" onclick="sendMessage()">Send</button>
            </div>
        </div>

        <div class="voice-controls">
            <button class="btn-voice" onclick="speakMessage()" id="speakBtn">
                üîä Speak
            </button>
            <button class="btn-voice" onclick="stopSpeaking()" id="stopBtn">
                ‚èπÔ∏è Stop
            </button>
            <button class="btn-voice" onclick="repeatMessage()" id="repeatBtn">
                üîÅ Repeat
            </button>
        </div>

        <div class="storage-info">
            üíæ Your conversations are automatically saved in your browser
            <div class="storage-buttons">
                <button class="btn-storage" onclick="viewSavedChats()">üìñ View</button>
                <button class="btn-storage" onclick="clearSavedChats()">üóëÔ∏è Clear</button>
                <button class="btn-storage" onclick="downloadChats()">‚¨áÔ∏è Download</button>
            </div>
        </div>

        <div class="footer">
            <div class="privacy-notice">
                üîí Your conversations are completely private and confidential
            </div>
            <div class="emergency-info">
                Need urgent help? Call <a href="tel:1098" class="emergency-link">CHILDLINE 1098</a> (India) - Free & Available 24/7
            </div>
        </div>
    </div>

    <!-- Modal for viewing saved chats -->
    <div class="modal" id="savedChatsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üìö Your Saved Conversations</h3>
                <button class="modal-close" onclick="closeModal()">√ó</button>
            </div>
            <div id="savedChatsList"></div>
        </div>
    </div>

    <script>
        let lastBotMessage = '';
        let currentSpeech = null;
        let conversationHistory = [];
        let deferredPrompt;

        // Load saved conversations when page loads
        function loadConversationHistory() {
            const saved = localStorage.getItem('studentSupportChats');
            if (saved) {
                conversationHistory = JSON.parse(saved);
            }
        }

        // Save conversation to localStorage
        function saveConversation(userMessage, botResponse) {
            const timestamp = new Date().toISOString();
            conversationHistory.push({
                timestamp: timestamp,
                user: userMessage,
                bot: botResponse,
                date: new Date().toLocaleString()
            });
            localStorage.setItem('studentSupportChats', JSON.stringify(conversationHistory));
        }

        // PWA Installation
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installBanner').style.display = 'block';
        });

        function promptInstall() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('App installed');
                    }
                    deferredPrompt = null;
                    closeInstallBanner();
                });
            } else {
                // For iOS Safari
                alert('To install on iPad:\n\n1. Tap the Share button (square with arrow)\n2. Scroll down and tap "Add to Home Screen"\n3. Tap "Add" in the top right');
            }
        }

        function closeInstallBanner() {
            document.getElementById('installBanner').style.display = 'none';
        }

        // Function to handle clicking sample questions
        function askQuestion(question) {
            document.getElementById('userInput').value = question;
            sendMessage();
        }

        // View all saved chats in modal
        function viewSavedChats() {
            if (conversationHistory.length === 0) {
                alert('No saved conversations yet. Start chatting to save your conversations!');
                return;
            }

            const modal = document.getElementById('savedChatsModal');
            const listDiv = document.getElementById('savedChatsList');
            
            let html = '';
            conversationHistory.forEach((chat, index) => {
                html += `
                    <div class="saved-conversation">
                        <h4>üí¨ Conversation ${index + 1}</h4>
                        <div class="timestamp">üìÖ ${chat.date}</div>
                        <div class="user-msg"><strong>You:</strong> ${chat.user}</div>
                        <div class="bot-msg"><strong>Support Buddy:</strong> ${chat.bot}</div>
                    </div>
                `;
            });
            
            listDiv.innerHTML = html;
            modal.classList.add('active');
        }

        function closeModal() {
            document.getElementById('savedChatsModal').classList.remove('active');
        }

        // Clear all saved chats
        function clearSavedChats() {
            if (confirm('Are you sure you want to clear all saved conversations? This cannot be undone.')) {
                localStorage.removeItem('studentSupportChats');
                conversationHistory = [];
                alert('‚úÖ All saved conversations have been cleared!');
            }
        }

        // Download chats as a text file
        function downloadChats() {
            if (conversationHistory.length === 0) {
                alert('No conversations to download yet!');
                return;
            }

            let textContent = 'STUDENT SUPPORT BUDDY - CONVERSATION HISTORY\n';
            textContent += '='.repeat(60) + '\n\n';
            
            conversationHistory.forEach((chat, index) => {
                textContent += `Conversation ${index + 1}\n`;
                textContent += `Date: ${chat.date}\n`;
                textContent += `\nYou: ${chat.user}\n`;
                textContent += `Support Buddy: ${chat.bot}\n`;
                textContent += '-'.repeat(60) + '\n\n';
            });

            const blob = new Blob([textContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `support-buddy-conversations-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Chatbot responses database
        const botResponses = {
            greetings: [
                "Hello! I'm glad you're here. Remember, it takes courage to talk about your feelings. How can I support you today?",
                "Hi! Welcome to your safe space. Whatever you're going through, you don't have to face it alone. What's on your mind?"
            ],
            bullying: [
                "I'm really sorry you're experiencing bullying. That must be really hard. Remember: 1) It's NOT your fault 2) You deserve to be treated with respect 3) Telling a trusted adult (teacher, parent, counselor) is not 'snitching' - it's protecting yourself. Would you like to talk about what's happening?",
                "Bullying is never okay, and you don't deserve to be treated that way. Here's what you can do: Talk to a trusted adult immediately, document what's happening (dates, times, what happened), stay near friends or adults, and remember that asking for help is a sign of strength, not weakness."
            ],
            family: [
                "Family problems can be really tough, especially when you feel caught in the middle. It's okay to have complicated feelings about your family. Remember that you can love your family and still feel hurt or frustrated by them. Would you like to share more about what's going on?",
                "It sounds like things are difficult at home right now. Here are some things that might help: 1) Find a trusted adult outside the family to talk to (teacher, counselor, friend's parent) 2) Remember that family conflicts are not your fault 3) Focus on things you can control, like your own reactions and seeking support. You're not alone in this."
            ],
            pressure: [
                "Feeling pressured by friends or classmates is really common, but that doesn't make it easier. Here's the truth: Real friends respect your boundaries. It's okay to say 'no' to things that make you uncomfortable. Your safety and well-being are more important than fitting in. What kind of pressure are you facing?",
                "Peer pressure can make you feel like you have to do things you don't want to do. Remember: 1) You have the right to make your own choices 2) True friends won't abandon you for saying 'no' 3) It's okay to walk away from situations that feel wrong 4) Talk to an adult you trust about what you're experiencing."
            ],
            anxiety: [
                "Feeling anxious or stressed is very common, especially for students. Here are some things that can help: 1) Take deep breaths (breathe in for 4, hold for 4, out for 4) 2) Talk to someone you trust 3) Break big problems into smaller steps 4) Remember that it's okay to not be perfect. What's making you feel anxious?",
                "Anxiety can feel overwhelming, but there are ways to manage it. Try these: Take a short walk, listen to calming music, write down your worries, talk to a friend or adult, and remember that many people feel the same way. If anxiety is affecting your daily life, please talk to a school counselor or doctor."
            ],
            loneliness: [
                "Feeling lonely is really painful, and I'm sorry you're going through this. Remember: 1) Being alone and feeling lonely are different - you can feel lonely even in a crowd 2) This feeling won't last forever 3) There are people who care about you, even if it doesn't feel that way right now. Would you like to talk about joining a club or activity where you might meet people with similar interests?",
                "Loneliness is tough, but there are ways to connect with others: 1) Join a school club or sports team 2) Volunteer for a cause you care about 3) Say 'hi' to someone new each day 4) Reconnect with an old friend 5) Talk to a counselor about making connections. You deserve to have good friends and feel connected."
            ],
            selfharm: [
                "I'm really concerned about what you're sharing. If you're thinking about hurting yourself, please talk to a trusted adult RIGHT NOW - a parent, teacher, school counselor, or call CHILDLINE 1098. Your life is precious and valuable. There are people who want to help you through this difficult time. You don't have to face this alone.",
                "What you're feeling is serious, and you deserve professional help immediately. Please reach out to: 1) CHILDLINE 1098 (free, confidential, 24/7) 2) Your school counselor 3) A parent or trusted adult 4) A doctor or mental health professional. These feelings can get better with the right support, but you need help from trained professionals. Please reach out today."
            ],
            default: [
                "Thank you for sharing that with me. It sounds like you're going through something difficult. Can you tell me more about how this makes you feel? Remember, expressing your feelings is an important first step.",
                "I hear you, and your feelings are valid. It's brave of you to talk about this. Would you like to explore some ways to handle this situation, or would you prefer to talk more about how you're feeling?",
                "That sounds challenging. Remember, everyone faces difficulties, and it's okay to ask for help. What do you think would help you feel better about this situation?"
            ],
            positive: [
                "That's wonderful! It's great to hear something positive. Remember to celebrate your wins, no matter how small they might seem. What made you feel this way?",
                "I'm so glad to hear that! Positive moments are important to acknowledge. Keep focusing on the things that make you feel good!"
            ]
        };

        function detectCategory(message) {
            const lowerMessage = message.toLowerCase();
            
            if (lowerMessage.includes('bully') || lowerMessage.includes('bullied') || lowerMessage.includes('tease') || lowerMessage.includes('pick on')) {
                return 'bullying';
            }
            if (lowerMessage.includes('family') || lowerMessage.includes('parent') || lowerMessage.includes('mom') || lowerMessage.includes('dad') || lowerMessage.includes('brother') || lowerMessage.includes('sister')) {
                return 'family';
            }
            if (lowerMessage.includes('pressure') || lowerMessage.includes('force') || lowerMessage.includes('peer')) {
                return 'pressure';
            }
            if (lowerMessage.includes('anxious') || lowerMessage.includes('anxiety') || lowerMessage.includes('stress') || lowerMessage.includes('worried') || lowerMessage.includes('nervous')) {
                return 'anxiety';
            }
            if (lowerMessage.includes('lonely') || lowerMessage.includes('alone') || lowerMessage.includes('no friends') || lowerMessage.includes('isolated')) {
                return 'loneliness';
            }
            if (lowerMessage.includes('hurt myself') || lowerMessage.includes('self harm') || lowerMessage.includes('suicide') || lowerMessage.includes('kill myself') || lowerMessage.includes('end it all')) {
                return 'selfharm';
            }
            if (lowerMessage.includes('hello') || lowerMessage.includes('hi ') || lowerMessage.includes('hey')) {
                return 'greetings';
            }
            if (lowerMessage.includes('happy') || lowerMessage.includes('great') || lowerMessage.includes('good') || lowerMessage.includes('better')) {
                return 'positive';
            }
            
            return 'default';
        }

        function getBotResponse(userMessage) {
            const category = detectCategory(userMessage);
            const responses = botResponses[category];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function addMessage(message, isUser) {
            const chatArea = document.getElementById('chatArea');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;
            
            const bubbleDiv = document.createElement('div');
            bubbleDiv.className = 'message-bubble';
            bubbleDiv.textContent = message;
            
            messageDiv.appendChild(bubbleDiv);
            chatArea.insertBefore(messageDiv, document.getElementById('typingIndicator'));
            
            chatArea.scrollTop = chatArea.scrollHeight;
            
            if (!isUser) {
                lastBotMessage = message;
            }
        }

        function showTyping() {
            document.getElementById('typingIndicator').style.display = 'block';
            document.getElementById('chatArea').scrollTop = document.getElementById('chatArea').scrollHeight;
        }

        function hideTyping() {
            document.getElementById('typingIndicator').style.display = 'none';
        }

        function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();
            
            if (message === '') return;
            
            // Add user message
            addMessage(message, true);
            input.value = '';
            
            // Show typing indicator
            showTyping();
            
            // Simulate bot thinking time
            setTimeout(() => {
                hideTyping();
                const botResponse = getBotResponse(message);
                addMessage(botResponse, false);
                
                // Save this conversation
                saveConversation(message, botResponse);
            }, 1000 + Math.random() * 1000);
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        function speakMessage() {
            if (lastBotMessage === '') {
                alert('No message to speak yet! Start a conversation first.');
                return;
            }
            
            stopSpeaking();
            
            currentSpeech = new SpeechSynthesisUtterance(lastBotMessage);
            currentSpeech.rate = 0.9;
            currentSpeech.pitch = 1;
            currentSpeech.volume = 1;
            
            document.getElementById('speakBtn').classList.add('active');
            
            currentSpeech.onend = function() {
                document.getElementById('speakBtn').classList.remove('active');
            };
            
            window.speechSynthesis.speak(currentSpeech);
        }

        function stopSpeaking() {
            window.speechSynthesis.cancel();
            document.getElementById('speakBtn').classList.remove('active');
        }

        function repeatMessage() {
            speakMessage();
        }

        // Focus on input when page loads and load conversation history
        window.onload = function() {
            loadConversationHistory();
            
            // Show install prompt on iOS after 30 seconds
            if (/iPad|iPhone|iPod/.test(navigator.userAgent) && !window.navigator.standalone) {
                setTimeout(() => {
                    document.getElementById('installBanner').style.display = 'block';
                }, 30000);
            }
        };

        // Prevent zoom on iOS
        document.addEventListener('gesturestart', function (e) {
            e.preventDefault();
        });
    </script>
</body>
</html>
